<!doctype html>
<html><head><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1.0" name="viewport"><title>quickslice - Aggregations</title><link href="/styles.css" rel="stylesheet"></head><body><div class="container"><aside class="sidebar"><div class="sidebar-brand"><svg xmlns="http://www.w3.org/2000/svg" class="sidebar-logo" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><defs xmlns="http://www.w3.org/2000/svg"><linearGradient xmlns="http://www.w3.org/2000/svg" id="board1" x1="0%" x2="100%" y1="0%" y2="100%"><stop xmlns="http://www.w3.org/2000/svg" offset="0%" stop-color="#FF6347" stop-opacity="1"></stop><stop xmlns="http://www.w3.org/2000/svg" offset="100%" stop-color="#FF4500" stop-opacity="1"></stop></linearGradient><linearGradient xmlns="http://www.w3.org/2000/svg" id="board2" x1="0%" x2="100%" y1="0%" y2="100%"><stop xmlns="http://www.w3.org/2000/svg" offset="0%" stop-color="#00CED1" stop-opacity="1"></stop><stop xmlns="http://www.w3.org/2000/svg" offset="100%" stop-color="#4682B4" stop-opacity="1"></stop></linearGradient></defs><g xmlns="http://www.w3.org/2000/svg" transform="translate(64, 64)"><ellipse xmlns="http://www.w3.org/2000/svg" cx="0" cy="-28" fill="url(#board1)" rx="50" ry="20"></ellipse><ellipse xmlns="http://www.w3.org/2000/svg" cx="0" cy="0" fill="url(#board2)" rx="60" ry="20"></ellipse><ellipse xmlns="http://www.w3.org/2000/svg" cx="0" cy="28" fill="#32CD32" rx="40" ry="20"></ellipse></g></svg><span class="sidebar-title">quickslice</span></div><nav><ul><li><a href="/">Getting Started</a></li><li><a href="/authentication">Authentication</a></li><li><a href="/queries">Queries</a></li><li><a href="/mutations">Mutations</a></li><li><a href="/joins">Joins</a></li><li><a class="active" href="/aggregations">Aggregations</a></li><li><a href="/subscriptions">Subscriptions</a></li><li><a href="/blobs">Blobs</a></li><li><a href="/variables">Variables</a></li><li><a href="/deployment">Deployment</a></li><li><a href="/mcp">MCP</a></li></ul></nav></aside><main class="content"><div><h1 id="Aggregations">Aggregations</h1>
<blockquote>
<p><strong>Note:</strong> Aggregation queries are public and do not require authentication.</p>
</blockquote>
<h2 id="Basic-Aggregation">Basic Aggregation</h2>
<p>Group records by a single field and count occurrences:</p>
<pre><code class="language-graphql">query {
  xyzStatusphereStatusAggregated(groupBy: [{field: status}]) {
    status
    count
  }
}
</code></pre>
<p>Returns groups with their counts:</p>
<pre><code class="language-json">{
  &quot;data&quot;: {
    &quot;xyzStatusphereStatusAggregated&quot;: [
      { &quot;status&quot;: &quot;üëç&quot;, &quot;count&quot;: 42 },
      { &quot;status&quot;: &quot;üëé&quot;, &quot;count&quot;: 18 }
    ]
  }
}
</code></pre>
<h2 id="Field-Selection">Field Selection</h2>
<p>Each collection has a type-safe <code>GroupByField</code> enum for available fields:</p>
<pre><code class="language-graphql">query {
  appBskyFeedPostAggregated(groupBy: [{field: lang}]) {
    lang
    count
  }
}
</code></pre>
<h2 id="Multiple-Fields">Multiple Fields</h2>
<p>Group by multiple fields simultaneously:</p>
<pre><code class="language-graphql">query {
  appBskyFeedPostAggregated(
    groupBy: [
      {field: author}
      {field: lang}
    ]
  ) {
    author
    lang
    count
  }
}
</code></pre>
<h2 id="Date-Truncation">Date Truncation</h2>
<p>Group datetime fields by time intervals using the <code>interval</code> parameter:</p>
<h3 id="Available-Intervals">Available Intervals</h3>
<ul>
<li><code>HOUR</code> - Truncate to hour</li>
<li><code>DAY</code> - Truncate to day</li>
<li><code>WEEK</code> - Truncate to week</li>
<li><code>MONTH</code> - Truncate to month</li>
</ul>
<h3 id="Group-by-Day">Group by Day</h3>
<pre><code class="language-graphql">query {
  appBskyFeedPostAggregated(
    groupBy: [{field: createdAt, interval: DAY}]
  ) {
    createdAt
    count
  }
}
</code></pre>
<h3 id="Group-by-Month">Group by Month</h3>
<pre><code class="language-graphql">query {
  xyzStatusphereStatusAggregated(
    groupBy: [{field: indexedAt, interval: MONTH}]
  ) {
    indexedAt
    count
  }
}
</code></pre>
<blockquote>
<p><strong>Note:</strong> Date intervals can only be applied to datetime fields. Applying intervals to other field types will return an error.</p>
</blockquote>
<h2 id="Filtering-with-WHERE">Filtering with WHERE</h2>
<p>Filter records before aggregation using the <code>where</code> argument:</p>
<pre><code class="language-graphql">query {
  appBskyFeedPostAggregated(
    groupBy: [{field: lang}]
    where: {
      likes: { gte: 50 }
    }
  ) {
    lang
    count
  }
}
</code></pre>
<h3 id="Complex-Filters">Complex Filters</h3>
<p>Combine multiple conditions with <code>and</code> and <code>or</code>:</p>
<pre><code class="language-graphql">query {
  appBskyFeedPostAggregated(
    groupBy: [{field: author}]
    where: {
      and: [
        { likes: { gte: 100 } }
        { lang: { eq: &quot;en&quot; } }
      ]
    }
  ) {
    author
    count
  }
}
</code></pre>
<h2 id="Sorting-Results">Sorting Results</h2>
<p>Sort aggregated results by count using the <code>orderBy</code> argument:</p>
<h3 id="Descending-Order-Most-Common-First">Descending Order (Most Common First)</h3>
<pre><code class="language-graphql">query {
  appBskyFeedPostAggregated(
    groupBy: [{field: lang}]
    orderBy: {count: DESC}
  ) {
    lang
    count
  }
}
</code></pre>
<h3 id="Ascending-Order-Least-Common-First">Ascending Order (Least Common First)</h3>
<pre><code class="language-graphql">query {
  appBskyFeedPostAggregated(
    groupBy: [{field: lang}]
    orderBy: {count: ASC}
  ) {
    lang
    count
  }
}
</code></pre>
<h2 id="Limiting-Results">Limiting Results</h2>
<p>Limit the number of groups returned using the <code>limit</code> parameter:</p>
<pre><code class="language-graphql">query {
  appBskyFeedPostAggregated(
    groupBy: [{field: author}]
    orderBy: {count: DESC}
    limit: 10
  ) {
    author
    count
  }
}
</code></pre>
<h2 id="Table-Columns">Table Columns</h2>
<p>Group by database table columns in addition to JSON fields:</p>
<h3 id="Group-by-DID">Group by DID</h3>
<pre><code class="language-graphql">query {
  appBskyFeedPostAggregated(groupBy: [{field: did}]) {
    did
    count
  }
}
</code></pre>
<h3 id="Group-by-Indexed-Date">Group by Indexed Date</h3>
<pre><code class="language-graphql">query {
  xyzStatusphereStatusAggregated(
    groupBy: [{field: indexedAt, interval: DAY}]
  ) {
    indexedAt
    count
  }
}
</code></pre>
<p>Available table columns: <code>uri</code>, <code>cid</code>, <code>did</code>, <code>collection</code>, <code>indexedAt</code></p>
<h2 id="Array-Fields">Array Fields</h2>
<p>Array fields can be grouped by in aggregations:</p>
<pre><code class="language-graphql">query {
  fmTealAlphaFeedPlayAggregated(
    groupBy: [{field: artists}]
  ) {
    artists
    count
  }
}
</code></pre>
<blockquote>
<p><strong>Note:</strong> Array fields return JSON objects in the response, not strings.</p>
</blockquote>
<h2 id="Complete-Example">Complete Example</h2>
<p>Combining all features - filtering, multiple groupBy fields, date truncation, ordering, and limiting:</p>
<pre><code class="language-graphql">query GetTopLanguagesByDay($minLikes: Int!, $limit: Int!) {
  appBskyFeedPostAggregated(
    groupBy: [
      {field: createdAt, interval: DAY}
      {field: lang}
    ]
    where: {
      likes: { gte: $minLikes }
    }
    orderBy: {count: DESC}
    limit: $limit
  ) {
    createdAt
    lang
    count
  }
}
</code></pre>
<p>Variables:</p>
<pre><code class="language-json">{
  &quot;minLikes&quot;: 50,
  &quot;limit&quot;: 20
}
</code></pre>
<p>Response:</p>
<pre><code class="language-json">{
  &quot;data&quot;: {
    &quot;appBskyFeedPostAggregated&quot;: [
      {
        &quot;createdAt&quot;: &quot;2024-01-15&quot;,
        &quot;lang&quot;: &quot;en&quot;,
        &quot;count&quot;: 342
      },
      {
        &quot;createdAt&quot;: &quot;2024-01-15&quot;,
        &quot;lang&quot;: &quot;fr&quot;,
        &quot;count&quot;: 127
      },
      {
        &quot;createdAt&quot;: &quot;2024-01-14&quot;,
        &quot;lang&quot;: &quot;en&quot;,
        &quot;count&quot;: 298
      }
    ]
  }
}
</code></pre>
<h2 id="Query-Structure">Query Structure</h2>
<p>Aggregated query fields follow this naming pattern:</p>
<ul>
<li><code>{collection}Aggregated</code> - Returns aggregated results</li>
<li>Parameters:
<ul>
<li><code>groupBy</code> (required): Array of fields to group by with optional intervals</li>
<li><code>where</code> (optional): Filter conditions</li>
<li><code>orderBy</code> (optional): Sort by count (ASC or DESC)</li>
<li><code>limit</code> (optional): Maximum number of groups to return (default: 100)</li>
</ul>
</li>
<li>Returns: Array of objects with group field values and <code>count</code></li>
</ul>
<h2 id="Validation">Validation</h2>
<p>The server validates aggregation queries:</p>
<ul>
<li><strong>Date intervals</strong>: Can only be applied to datetime fields</li>
<li><strong>Query complexity</strong>: Maximum 5 groupBy fields allowed per query</li>
<li><strong>Field existence</strong>: All groupBy fields must exist in the collection schema</li>
</ul>
</div></main></div><script src="/highlight.js"></script></body></html>