<!doctype html>
<html><head><meta charset="UTF-8"><meta content="width=device-width, initial-scale=1.0" name="viewport"><title>quickslice - Deployment</title><link href="/styles.css" rel="stylesheet"></head><body><button aria-label="Toggle menu" class="menu-toggle"><svg xmlns="http://www.w3.org/2000/svg" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><line xmlns="http://www.w3.org/2000/svg" x1="3" x2="21" y1="6" y2="6"></line><line xmlns="http://www.w3.org/2000/svg" x1="3" x2="21" y1="12" y2="12"></line><line xmlns="http://www.w3.org/2000/svg" x1="3" x2="21" y1="18" y2="18"></line></svg></button><div class="sidebar-backdrop"></div><div class="container"><aside class="sidebar"><div class="sidebar-brand"><svg xmlns="http://www.w3.org/2000/svg" class="sidebar-logo" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><defs xmlns="http://www.w3.org/2000/svg"><linearGradient xmlns="http://www.w3.org/2000/svg" id="board1" x1="0%" x2="100%" y1="0%" y2="100%"><stop xmlns="http://www.w3.org/2000/svg" offset="0%" stop-color="#FF6347" stop-opacity="1"></stop><stop xmlns="http://www.w3.org/2000/svg" offset="100%" stop-color="#FF4500" stop-opacity="1"></stop></linearGradient><linearGradient xmlns="http://www.w3.org/2000/svg" id="board2" x1="0%" x2="100%" y1="0%" y2="100%"><stop xmlns="http://www.w3.org/2000/svg" offset="0%" stop-color="#00CED1" stop-opacity="1"></stop><stop xmlns="http://www.w3.org/2000/svg" offset="100%" stop-color="#4682B4" stop-opacity="1"></stop></linearGradient></defs><g xmlns="http://www.w3.org/2000/svg" transform="translate(64, 64)"><ellipse xmlns="http://www.w3.org/2000/svg" cx="0" cy="-28" fill="url(#board1)" rx="50" ry="20"></ellipse><ellipse xmlns="http://www.w3.org/2000/svg" cx="0" cy="0" fill="url(#board2)" rx="60" ry="20"></ellipse><ellipse xmlns="http://www.w3.org/2000/svg" cx="0" cy="28" fill="#32CD32" rx="40" ry="20"></ellipse></g></svg><span class="sidebar-title">quickslice</span></div><nav><ul><li><a href="/">Getting Started</a></li><li><a href="/authentication">Authentication</a></li><li><a href="/queries">Queries</a></li><li><a href="/mutations">Mutations</a></li><li><a href="/joins">Joins</a></li><li><a href="/aggregations">Aggregations</a></li><li><a href="/subscriptions">Subscriptions</a></li><li><a href="/blobs">Blobs</a></li><li><a href="/variables">Variables</a></li><li><a class="active" href="/deployment">Deployment</a></li><li><a href="/mcp">MCP</a></li></ul></nav></aside><main class="content"><div><h1 id="Deployment-WIP">Deployment (WIP)</h1>
<p>This guide covers deploying quickslice on Fly.io and Railway. Both platforms support Docker deployments with persistent volumes for SQLite.</p>
<h2 id="Environment-Variables">Environment Variables</h2>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Required</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DATABASE_URL</code></td>
<td>No</td>
<td><code>quickslice.db</code></td>
<td>Path to SQLite database file. Use <code>/data/quickslice.db</code> with volume mount</td>
</tr>
<tr>
<td><code>HOST</code></td>
<td>No</td>
<td><code>127.0.0.1</code></td>
<td>Server bind address. Set to <code>0.0.0.0</code> for containers</td>
</tr>
<tr>
<td><code>PORT</code></td>
<td>No</td>
<td><code>8080</code></td>
<td>Server port</td>
</tr>
<tr>
<td><code>SECRET_KEY_BASE</code></td>
<td>Recommended</td>
<td>Auto-generated</td>
<td>Session encryption key (64+ chars). <strong>Must persist across restarts</strong></td>
</tr>
<tr>
<td><code>EXTERNAL_BASE_URL</code></td>
<td>Optional</td>
<td><code>http://localhost:8080</code></td>
<td>Base URL of your application (used for OAuth redirect URIs and client metadata). Use <code>http://127.0.0.1:8080</code> for loopback mode</td>
</tr>
<tr>
<td><code>OAUTH_LOOPBACK_MODE</code></td>
<td>Optional</td>
<td><code>false</code></td>
<td>Set to <code>true</code> for local development without ngrok. Uses loopback client IDs instead of client metadata URLs</td>
</tr>
<tr>
<td><code>PLC_DIRECTORY_URL</code></td>
<td>Optional</td>
<td><code>https://plc.directory</code></td>
<td>PLC directory URL override (useful for self-hosted PLC directories)</td>
</tr>
</tbody>
</table>
<h3 id="Critical-Environment-Variables">Critical Environment Variables</h3>
<ul>
<li><strong>DATABASE_URL</strong>: Must point to a persistent volume location</li>
<li><strong>SECRET_KEY_BASE</strong>: Generate with <code>openssl rand -base64 48</code>. Store as a secret and keep persistent</li>
<li><strong>HOST</strong>: Set to <code>0.0.0.0</code> in container environments</li>
</ul>
<h2 id="SQLite-Volume-Setup">SQLite Volume Setup</h2>
<p>SQLite requires persistent storage for three files:</p>
<ul>
<li><code>{DATABASE_URL}</code> - Main database file</li>
<li><code>{DATABASE_URL}-shm</code> - Shared memory file</li>
<li><code>{DATABASE_URL}-wal</code> - Write-ahead log</li>
</ul>
<p><strong>IMPORTANT</strong>: Without persistent storage, all data will be lost on container restart.</p>
<h2 id="Flyio">Fly.io</h2>
<h3 id="1-Create-a-volume">1. Create a volume</h3>
<pre><code class="language-bash">fly volumes create app_data --size 10
</code></pre>
<h3 id="2-Configure-flytoml">2. Configure fly.toml</h3>
<p>Create <code>fly.toml</code> in your project root:</p>
<pre><code class="language-toml">app = 'your-app-name'
primary_region = 'sjc'

[build]
  dockerfile = &quot;Dockerfile&quot;

[env]
  DATABASE_URL = '/data/quickslice.db'
  HOST = '0.0.0.0'
  PORT = '8080'

[http_service]
  internal_port = 8080
  force_https = true
  auto_stop_machines = 'stop'
  auto_start_machines = true
  min_machines_running = 1

[[mounts]]
  source = 'app_data'
  destination = '/data'

[[vm]]
  memory = '1gb'
  cpu_kind = 'shared'
  cpus = 1
</code></pre>
<h3 id="3-Set-secrets">3. Set secrets</h3>
<pre><code class="language-bash">fly secrets set SECRET_KEY_BASE=$(openssl rand -base64 48)
</code></pre>
<h3 id="4-Deploy">4. Deploy</h3>
<pre><code class="language-bash">fly deploy
</code></pre>
<h3 id="5-Verify-health">5. Verify health</h3>
<pre><code class="language-bash">fly status
curl https://your-app.fly.dev/health
</code></pre>
<h2 id="Railway">Railway</h2>
<h3 id="1-Create-a-new-project">1. Create a new project</h3>
<p>Connect your GitHub repository or deploy from the CLI.</p>
<h3 id="2-Configure-environment-variables">2. Configure environment variables</h3>
<p>In the Railway dashboard, add these variables:</p>
<pre><code>DATABASE_URL=/data/quickslice.db
HOST=0.0.0.0
PORT=8080
SECRET_KEY_BASE=&lt;generate-with-openssl-rand&gt;
</code></pre>
<h3 id="3-Add-a-volume">3. Add a volume</h3>
<p>In the Railway dashboard:</p>
<ol>
<li>Go to your service settings</li>
<li>Add a volume mount</li>
<li>Mount path: <code>/data</code></li>
<li>Size: 10GB (or as needed)</li>
</ol>
<h3 id="4-Configure-health-check">4. Configure health check</h3>
<p>In the service settings, set the health check path to <code>/health</code>.</p>
<h3 id="5-Deploy">5. Deploy</h3>
<p>Railway will automatically deploy when you push to your connected branch.</p>
<h3 id="Optional-railwayjson">Optional: railway.json</h3>
<p>Create <code>railway.json</code> for declarative configuration:</p>
<pre><code class="language-json">{
  &quot;$schema&quot;: &quot;https://railway.app/railway.schema.json&quot;,
  &quot;build&quot;: {
    &quot;builder&quot;: &quot;DOCKERFILE&quot;,
    &quot;dockerfilePath&quot;: &quot;Dockerfile&quot;
  },
  &quot;deploy&quot;: {
    &quot;numReplicas&quot;: 1,
    &quot;restartPolicyType&quot;: &quot;ON_FAILURE&quot;,
    &quot;restartPolicyMaxRetries&quot;: 10,
    &quot;healthcheckPath&quot;: &quot;/health&quot;,
    &quot;healthcheckTimeout&quot;: 100
  }
}
</code></pre>
<h2 id="Docker-Compose-Self-Hosted">Docker Compose (Self-Hosted)</h2>
<p>For self-hosted deployments, use the published Docker image:</p>
<pre><code class="language-yaml">version: &quot;3.8&quot;

services:
  quickslice:
    image: ghcr.io/bigmoves/quickslice:latest
    ports:
      - &quot;8080:8080&quot;
    volumes:
      - quickslice-data:/data
      - ./lexicons:/app/priv/lexicons:ro  # Optional: custom lexicons
    environment:
      - HOST=0.0.0.0
      - PORT=8080
      - DATABASE_URL=/data/quickslice.db
      - SECRET_KEY_BASE=${SECRET_KEY_BASE}
    restart: unless-stopped
    healthcheck:
      test: [&quot;CMD&quot;, &quot;wget&quot;, &quot;--spider&quot;, &quot;-q&quot;, &quot;http://localhost:8080/health&quot;]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  quickslice-data:
</code></pre>
<p>Create a <code>.env</code> file for secrets:</p>
<pre><code class="language-bash">SECRET_KEY_BASE=&lt;generate-with-openssl-rand&gt;
</code></pre>
<p>Start the service:</p>
<pre><code class="language-bash">docker compose up -d
</code></pre>
<h2 id="Post-Deployment">Post-Deployment</h2>
<h3 id="Health-check">Health check</h3>
<p>Verify the service is running:</p>
<pre><code class="language-bash">curl https://your-app-url/health
</code></pre>
<p>Expected response:</p>
<pre><code class="language-json">{&quot;status&quot;:&quot;healthy&quot;}
</code></pre>
<h3 id="Access-GraphiQL">Access GraphiQL</h3>
<p>Navigate to <code>/graphiql</code> (requires authentication).</p>
<h3 id="Database-access">Database access</h3>
<p><strong>Fly.io</strong>:</p>
<pre><code class="language-bash">fly ssh console
sqlite3 /data/quickslice.db
</code></pre>
<p><strong>Railway</strong>:
Use the Railway CLI or connect via SSH from the dashboard.</p>
<p><strong>Docker</strong>:</p>
<pre><code class="language-bash">docker exec -it &lt;container-name&gt; sqlite3 /data/quickslice.db
</code></pre>
<h3 id="Logs">Logs</h3>
<p><strong>Fly.io</strong>:</p>
<pre><code class="language-bash">fly logs
</code></pre>
<p><strong>Railway</strong>:
View logs in the dashboard or use <code>railway logs</code>.</p>
<p><strong>Docker</strong>:</p>
<pre><code class="language-bash">docker compose logs -f quickslice
</code></pre>
<h2 id="Backfill-Configuration">Backfill Configuration</h2>
<p>Control memory usage during backfill operations with these environment variables:</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>BACKFILL_MAX_PDS_WORKERS</code></td>
<td>10</td>
<td>Max concurrent PDS endpoints being processed</td>
</tr>
<tr>
<td><code>BACKFILL_PDS_CONCURRENCY</code></td>
<td>4</td>
<td>Max concurrent repo fetches per PDS</td>
</tr>
<tr>
<td><code>BACKFILL_MAX_HTTP_CONCURRENT</code></td>
<td>50</td>
<td>Global HTTP request limit</td>
</tr>
<tr>
<td><code>BACKFILL_REPO_TIMEOUT</code></td>
<td>60</td>
<td>Timeout per repo fetch (seconds)</td>
</tr>
</tbody>
</table>
<h3 id="Recommended-Settings-by-VPS-Size">Recommended Settings by VPS Size</h3>
<p><strong>1GB RAM (e.g., Railway starter):</strong></p>
<pre><code>BACKFILL_MAX_PDS_WORKERS=8
BACKFILL_PDS_CONCURRENCY=2
BACKFILL_MAX_HTTP_CONCURRENT=30
</code></pre>
<p><strong>2GB RAM:</strong></p>
<pre><code>BACKFILL_MAX_PDS_WORKERS=15
BACKFILL_PDS_CONCURRENCY=4
BACKFILL_MAX_HTTP_CONCURRENT=50
</code></pre>
<p><strong>4GB+ RAM:</strong></p>
<pre><code>BACKFILL_MAX_PDS_WORKERS=25
BACKFILL_PDS_CONCURRENCY=6
BACKFILL_MAX_HTTP_CONCURRENT=100
</code></pre>
<h2 id="Resource-Requirements">Resource Requirements</h2>
<p><strong>Minimum</strong>:</p>
<ul>
<li>Memory: 1GB</li>
<li>CPU: 1 shared core</li>
<li>Disk: 10GB volume (for SQLite database)</li>
</ul>
<p><strong>Recommendations</strong>:</p>
<ul>
<li>Scale memory for high-traffic deployments</li>
<li>Use SSD-backed volumes for SQLite performance</li>
<li>Monitor database size and scale volume as needed</li>
</ul>
</div></main></div><script src="/highlight.js"></script><script src="/mobile-nav.js"></script></body></html>